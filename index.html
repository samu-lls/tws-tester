<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Teste de Fone</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-snap-type:y mandatory;overflow-y:scroll;height:100%;scroll-behavior:auto}
body{font-family:'DM Sans',sans-serif;background:#07070f;color:#f0f0f5;overflow-x:hidden;cursor:none}

/* â”€â”€ Custom cursor (desktop only) â”€â”€ */
#cur{position:fixed;width:9px;height:9px;background:#fff;border-radius:50%;pointer-events:none;z-index:9999;transform:translate(-50%,-50%);mix-blend-mode:difference;transition:width .15s,height .15s}
#cur.h{width:5px;height:5px}
#curR{position:fixed;width:34px;height:34px;border:1.5px solid rgba(255,255,255,.4);border-radius:50%;pointer-events:none;z-index:9998;transform:translate(-50%,-50%);transition:width .2s,height .2s,opacity .2s}
#curR.h{width:48px;height:48px;opacity:.35}

/* â”€â”€ Hidden YouTube container â”€â”€ */
#yt-container{position:fixed;bottom:-200px;left:-200px;width:1px;height:1px;opacity:0;pointer-events:none;z-index:-1}

/* â”€â”€ Sections â”€â”€ */
section{width:100%;height:100vh;scroll-snap-align:start;position:relative;overflow:hidden;display:flex;flex-direction:column}
section::after{content:'';position:absolute;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.04'/%3E%3C/svg%3E");pointer-events:none;z-index:2;opacity:.7}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANDING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#landing{background:#07070f}
.l-bg{position:absolute;inset:0;background:radial-gradient(ellipse 70% 60% at 15% 85%,rgba(29,185,84,.13) 0,transparent 55%),radial-gradient(ellipse 55% 50% at 85% 15%,rgba(100,60,200,.09) 0,transparent 55%);animation:breathe 10s ease-in-out infinite alternate}
@keyframes breathe{from{opacity:.6}to{opacity:1}}
.l-inner{position:relative;z-index:3;display:grid;grid-template-rows:auto 1fr auto;height:100%;padding:28px 56px 36px}
.topbar{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.07);padding-bottom:18px}
.brand{font-size:.7rem;font-weight:700;letter-spacing:4px;text-transform:uppercase;color:rgba(255,255,255,.35)}
.scroll-hint{font-size:.65rem;letter-spacing:2.5px;text-transform:uppercase;color:rgba(255,255,255,.28);display:flex;align-items:center;gap:8px;animation:ph 2.5s ease-in-out infinite}
.sh-dot{width:5px;height:5px;border-radius:50%;background:#1DB954;animation:blink 1.5s ease-in-out infinite}
@keyframes blink{0%,100%{opacity:.25}50%{opacity:1}}
@keyframes ph{0%,100%{opacity:.4}50%{opacity:.9}}
.hero-area{display:flex;flex-direction:column;justify-content:center;padding:16px 0}
.h-eyebrow{font-size:.66rem;font-weight:600;letter-spacing:4px;text-transform:uppercase;color:#1DB954;margin-bottom:20px;display:flex;align-items:center;gap:10px}
.h-eyebrow::before{content:'';width:28px;height:1px;background:#1DB954}
.h1{font-family:'Cormorant Garamond',serif;font-size:clamp(3.2rem,6.5vw,6.5rem);line-height:.93;font-weight:300;letter-spacing:-3px;color:#fff;margin-bottom:20px}
.h1 em{font-style:italic;color:rgba(255,255,255,.38)}
.h-sub{max-width:460px;font-size:.88rem;line-height:1.85;color:rgba(255,255,255,.37);font-weight:300}
.challenges-area{display:flex;flex-direction:column;gap:11px;padding-top:16px}
.lvl-row{display:flex;align-items:center;gap:14px}
.lvl-tag{width:58px;flex-shrink:0;display:flex;flex-direction:column;gap:4px}
.lvl-name{font-size:.58rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:rgba(255,255,255,.25)}
.lvl-pips{display:flex;gap:3px}
.lvl-pip{width:5px;height:5px;border-radius:50%;background:rgba(255,255,255,.1)}
.chips{display:flex;flex-wrap:wrap;gap:7px}
.chip{padding:7px 15px;border-radius:999px;border:1px solid rgba(255,255,255,.09);background:rgba(255,255,255,.03);font-size:.72rem;font-weight:500;color:rgba(255,255,255,.6);cursor:pointer;transition:all .22s;backdrop-filter:blur(8px);position:relative;overflow:hidden}
.chip::before{content:'';position:absolute;inset:0;background:var(--c,#1DB954);opacity:0;transition:opacity .2s;border-radius:999px}
.chip:hover{border-color:var(--c,#1DB954);color:#fff;transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.4)}
.chip:hover::before{opacity:.13}
.chip span{position:relative;z-index:1}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PLAYLIST PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#playlist-page{background:#07070f;justify-content:center;align-items:center}
.pl-bg{position:absolute;inset:0;background:radial-gradient(ellipse 60% 60% at 80% 20%,rgba(29,185,84,.1) 0,transparent 55%),radial-gradient(ellipse 50% 50% at 20% 80%,rgba(100,60,200,.08) 0,transparent 55%)}
.pl-inner{position:relative;z-index:3;display:flex;flex-direction:column;justify-content:center;align-items:flex-start;padding:0 80px;width:100%;max-width:860px;gap:0}
.pl-eyebrow{font-size:.62rem;font-weight:700;letter-spacing:4px;text-transform:uppercase;color:#1DB954;margin-bottom:20px;display:flex;align-items:center;gap:10px}
.pl-eyebrow::before{content:'';width:24px;height:1px;background:#1DB954}
.pl-title{font-family:'Cormorant Garamond',serif;font-size:clamp(3rem,5.5vw,5.5rem);line-height:.93;font-weight:300;letter-spacing:-3px;color:#fff;margin-bottom:20px}
.pl-title em{font-style:italic;color:rgba(255,255,255,.38)}
.pl-desc{font-size:.9rem;line-height:1.9;color:rgba(255,255,255,.38);font-weight:300;margin-bottom:40px;max-width:500px}
.pl-tracks-preview{display:flex;flex-direction:column;gap:6px;margin-bottom:40px;max-width:540px;width:100%}
.pl-track-pill{display:flex;align-items:center;gap:12px;padding:8px 14px;border-radius:10px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06)}
.pl-track-num{font-size:.6rem;color:rgba(255,255,255,.2);font-weight:600;width:18px;text-align:right;flex-shrink:0}
.pl-track-name{font-size:.78rem;font-weight:500;color:rgba(255,255,255,.65);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.pl-track-artist{font-size:.7rem;color:rgba(255,255,255,.28);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;text-align:right}
.pl-btn-row{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
.pl-open-btn{display:inline-flex;align-items:center;gap:10px;padding:14px 28px;border-radius:999px;background:rgba(29,185,84,.15);border:1px solid rgba(29,185,84,.35);color:#1DB954;font-size:.78rem;font-weight:600;letter-spacing:1px;text-decoration:none;transition:all .22s;text-transform:uppercase}
.pl-open-btn:hover{background:rgba(29,185,84,.26);transform:translateY(-2px);box-shadow:0 10px 30px rgba(29,185,84,.2)}
.pl-count{font-size:.7rem;color:rgba(255,255,255,.22);letter-spacing:1px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRACK SECTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ts{justify-content:center;align-items:center}
.t-bg{position:absolute;inset:-60px;background-size:cover;background-position:center;filter:blur(90px) saturate(1.6) brightness(.28);transform:scale(1.15)}
.t-ov{position:absolute;inset:0;background:radial-gradient(ellipse 75% 75% at 50% 50%,rgba(7,7,15,0) 25%,rgba(7,7,15,.9) 75%),linear-gradient(to bottom,rgba(7,7,15,.7) 0,transparent 25%,transparent 75%,rgba(7,7,15,.85) 100%)}
.t-prog{position:absolute;top:0;left:0;height:2px;background:linear-gradient(90deg,var(--tc,#1DB954),color-mix(in srgb,var(--tc,#1DB954) 60%,#fff));width:0%;z-index:10;box-shadow:0 0 10px var(--tc,#1DB954);transition:width .25s linear}
.t-nav{position:absolute;top:22px;left:0;right:0;display:flex;justify-content:space-between;align-items:center;padding:0 44px;z-index:10}
.t-ctr{font-size:.62rem;letter-spacing:3px;text-transform:uppercase;color:rgba(255,255,255,.28)}
.t-genre{font-size:.6rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;padding:4px 13px;border-radius:999px;border:1px solid var(--tc,#1DB954);color:var(--tc,#1DB954);background:color-mix(in srgb,var(--tc,#1DB954) 8%,transparent);backdrop-filter:blur(8px)}

/* Desktop: two-column layout */
.t-content{position:relative;z-index:5;display:grid;grid-template-columns:1fr 1fr;gap:72px;align-items:center;padding:0 56px;width:100%;max-width:1160px}
.challenge-label{font-size:.62rem;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--tc,#1DB954);margin-bottom:12px;display:flex;align-items:center;gap:8px}
.challenge-label::before{content:'';width:18px;height:1px;background:var(--tc,#1DB954)}
.t-title{font-family:'Cormorant Garamond',serif;font-size:clamp(2.6rem,4.5vw,4.8rem);line-height:.93;font-weight:300;letter-spacing:-2px;color:#fff;margin-bottom:8px}
.t-artist{font-size:.88rem;color:rgba(255,255,255,.38);font-weight:300;margin-bottom:26px;letter-spacing:.3px}
.t-desc{font-size:.82rem;line-height:1.85;color:rgba(255,255,255,.45);max-width:400px;font-weight:300;border-left:2px solid var(--tc,#1DB954);padding-left:14px}
.t-player{display:flex;flex-direction:column;align-items:center;gap:22px}

/* Vinyl record */
.vinyl{width:190px;height:190px;border-radius:50%;position:relative;
  background:conic-gradient(#191919 0deg,#0f0f0f 12deg,#191919 24deg,#0f0f0f 36deg,#191919 48deg,#0f0f0f 60deg,#191919 72deg,#0f0f0f 84deg,#191919 96deg,#0f0f0f 108deg,#191919 120deg,#0f0f0f 132deg,#191919 144deg,#0f0f0f 156deg,#191919 168deg,#0f0f0f 180deg,#191919 192deg,#0f0f0f 204deg,#191919 216deg,#0f0f0f 228deg,#191919 240deg,#0f0f0f 252deg,#191919 264deg,#0f0f0f 276deg,#191919 288deg,#0f0f0f 300deg,#191919 312deg,#0f0f0f 324deg,#191919 336deg,#0f0f0f 348deg);
  box-shadow:0 0 0 1.5px rgba(255,255,255,.05),0 24px 60px rgba(0,0,0,.8);
  animation:spin 8s linear infinite paused}
.vinyl::before{content:'';position:absolute;inset:28%;border-radius:50%;background:var(--tc,#1DB954);box-shadow:0 0 20px var(--tc,#1DB954);opacity:.9}
.vinyl::after{content:'';position:absolute;inset:46%;border-radius:50%;background:#07070f;box-shadow:0 0 0 1.5px rgba(255,255,255,.08)}
.vinyl.playing{animation-play-state:running}
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}

.waveform{display:flex;align-items:flex-end;gap:3px;height:38px}
.wb{width:3px;border-radius:3px;background:var(--tc,#1DB954);opacity:.6;animation:wa .9s ease-in-out infinite alternate paused}
.waveform.playing .wb{animation-play-state:running}
@keyframes wa{from{transform:scaleY(.15)}to{transform:scaleY(1)}}
.controls-row{display:flex;align-items:center;gap:14px}
.play-btn{width:58px;height:58px;border-radius:50%;background:rgba(255,255,255,.08);border:1.5px solid rgba(255,255,255,.18);color:#fff;font-size:17px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;backdrop-filter:blur(10px)}
.play-btn:hover{background:rgba(255,255,255,.18);transform:scale(1.06)}
.play-btn.playing{background:var(--tc,#1DB954);border-color:var(--tc,#1DB954);color:#000}
.play-btn.loading{opacity:.6;cursor:wait}
.a-prog{width:100%;display:flex;flex-direction:column;gap:5px}
.a-track{width:100%;height:2px;background:rgba(255,255,255,.1);border-radius:2px;cursor:pointer;position:relative}
.a-fill{height:100%;background:var(--tc,#1DB954);border-radius:2px;width:0%}
.a-times{display:flex;justify-content:space-between;font-size:.6rem;color:rgba(255,255,255,.28);letter-spacing:.4px}
.t-footer{position:absolute;bottom:0;left:0;right:0;display:flex;justify-content:space-between;align-items:center;padding:18px 44px;z-index:10}
.diff{display:flex;align-items:center;gap:8px;font-size:.6rem;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,.22)}
.d-pips{display:flex;gap:4px}
.d-pip{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.1)}
.d-pip.on{background:var(--tc,#1DB954);box-shadow:0 0 5px var(--tc,#1DB954)}
.next-cue{font-size:.6rem;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,.2);display:flex;align-items:center;gap:7px;animation:fc 2.2s ease-in-out infinite}
.nc-arrow{width:18px;height:18px;border-right:1px solid rgba(255,255,255,.18);border-bottom:1px solid rgba(255,255,255,.18);transform:rotate(45deg);margin-top:-5px}
@keyframes fc{0%,100%{transform:translateY(0)}50%{transform:translateY(4px)}}

/* â”€â”€ Side dots â”€â”€ */
#sdots{position:fixed;right:22px;top:50%;transform:translateY(-50%);z-index:100;display:flex;flex-direction:column;gap:8px}
.sdot{width:5px;height:5px;border-radius:50%;background:rgba(255,255,255,.14);cursor:pointer;transition:all .28s}
.sdot.active{background:#fff;transform:scale(1.5);box-shadow:0 0 7px rgba(255,255,255,.35)}
.sdot:hover{background:rgba(255,255,255,.45)}

/* â”€â”€ Toast â”€â”€ */
#toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);z-index:1000;background:rgba(15,15,25,.95);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:12px 20px;font-size:.73rem;color:rgba(255,255,255,.65);display:flex;align-items:center;gap:10px;backdrop-filter:blur(20px);opacity:0;transition:opacity .3s;pointer-events:none;white-space:nowrap}
#toast.show{opacity:1}
#toast .t-icon{font-size:1rem}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOBILE â€” telas atÃ© 768px
   Layout: coluna Ãºnica, vinil menor no topo,
   info abaixo, player compacto
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:768px){

  /* Cursor off em touch */
  body{cursor:auto}
  #cur,#curR{display:none}

  /* Side dots menores, mais Ã  beira */
  #sdots{right:10px;gap:5px}
  .sdot{width:4px;height:4px}

  /* Toast menor e nÃ£o transborda */
  #toast{font-size:.65rem;padding:10px 14px;white-space:normal;text-align:center;max-width:88vw;bottom:18px}

  /* â”€â”€ LANDING mobile â”€â”€ */
  .l-inner{padding:22px 24px 24px;grid-template-rows:auto auto 1fr}
  .topbar{padding-bottom:14px}
  .brand{font-size:.62rem;letter-spacing:3px}
  .scroll-hint{font-size:.58rem;letter-spacing:1.5px}
  .hero-area{padding:12px 0 8px}
  .h-eyebrow{font-size:.58rem;margin-bottom:14px}
  .h1{font-size:clamp(2.4rem,11vw,3.8rem);letter-spacing:-2px;margin-bottom:12px}
  .h-sub{font-size:.78rem;line-height:1.7;max-width:100%}

  /* Chips Ã¡rea com scroll horizontal por nÃ­vel */
  .challenges-area{gap:8px;padding-top:10px;overflow-y:auto;max-height:none}
  .lvl-row{gap:8px;align-items:flex-start}
  .lvl-tag{width:46px}
  .lvl-name{font-size:.5rem;letter-spacing:1px}
  .lvl-pips{gap:2px}
  .lvl-pip{width:4px;height:4px}
  .chips{gap:5px;flex-wrap:wrap}
  .chip{padding:5px 11px;font-size:.65rem}

  /* â”€â”€ PLAYLIST PAGE mobile â”€â”€ */
  .pl-inner{padding:24px 24px;justify-content:center}
  .pl-eyebrow{font-size:.55rem;margin-bottom:12px}
  .pl-title{font-size:clamp(2rem,9vw,3rem);letter-spacing:-2px;margin-bottom:12px}
  .pl-desc{font-size:.78rem;margin-bottom:20px;line-height:1.7}
  .pl-tracks-preview{gap:5px;margin-bottom:22px}
  .pl-track-pill{padding:7px 10px;border-radius:8px}
  .pl-track-num{font-size:.55rem}
  .pl-track-name{font-size:.72rem}
  .pl-track-artist{font-size:.62rem}
  .pl-open-btn{padding:11px 20px;font-size:.7rem}
  .pl-count{font-size:.62rem}

  /* â”€â”€ TRACK SECTIONS mobile â”€â”€
     Layout: coluna Ãºnica
     Topo: nav (contador + gÃªnero)
     Centro: vinil pequeno + info empilhada
     Baixo: player compacto + footer
  */
  .t-nav{padding:0 20px;top:18px}
  .t-ctr{font-size:.55rem;letter-spacing:2px}
  .t-genre{font-size:.52rem;padding:3px 10px}

  /* Grid vira coluna, centralizando tudo */
  .t-content{
    grid-template-columns:1fr;
    gap:0;
    padding:0 24px;
    align-items:center;
    justify-items:center;
    text-align:center;
    padding-top:56px; /* espaÃ§o para o t-nav */
  }

  /* Texto info: centralizado */
  .challenge-label{justify-content:center;margin-bottom:8px;font-size:.55rem}
  .challenge-label::before{display:none}
  .t-title{font-size:clamp(1.9rem,8vw,2.8rem);letter-spacing:-1.5px;margin-bottom:4px}
  .t-artist{font-size:.78rem;margin-bottom:14px}
  .t-desc{
    font-size:.74rem;
    line-height:1.7;
    max-width:100%;
    border-left:none;
    border-top:2px solid var(--tc,#1DB954);
    padding-left:0;
    padding-top:10px;
    margin-bottom:0;
    text-align:left;
  }

  /* Player: vinil menor, tudo compacto */
  .t-player{
    gap:14px;
    width:100%;
    align-items:center;
    padding-top:16px;
  }
  .vinyl{width:120px;height:120px}
  .waveform{height:28px}
  .wb{width:2.5px}
  .play-btn{width:52px;height:52px;font-size:16px}
  .a-prog{max-width:100%}
  .a-track{height:3px} /* slightly thicker for touch */
  .a-times{font-size:.58rem}

  /* Footer mobile: menor padding */
  .t-footer{padding:12px 20px}
  .diff{font-size:.52rem;gap:6px}
  .d-pip{width:5px;height:5px}
  .next-cue{font-size:.52rem;gap:5px}
  .nc-arrow{width:14px;height:14px}
}

/* â”€â”€ Pequenos ajustes para telas muito pequenas (â‰¤390px, ex: iPhone SE) â”€â”€ */
@media(max-width:390px){
  .h1{font-size:clamp(2rem,10vw,2.6rem)}
  .t-title{font-size:clamp(1.6rem,8vw,2.2rem)}
  .vinyl{width:100px;height:100px}
  .l-inner{padding:18px 18px 20px}
  .t-content{padding:0 18px;padding-top:52px}
  .t-nav{padding:0 16px}
  .t-footer{padding:10px 16px}
  .pl-inner{padding:20px 18px}
}
</style>
</head>
<body>

<div id="yt-container"><div id="yt-player"></div></div>
<div id="cur"></div>
<div id="curR"></div>
<div id="sdots"></div>
<div id="toast"><span class="t-icon">ğŸµ</span><span id="toast-msg">Carregando...</span></div>

<!-- â•â•â• LANDING â•â•â• -->
<section id="landing">
  <div class="l-bg"></div>
  <div class="l-inner">
    <div class="topbar">
      <span class="brand">Teste de Fone</span>
      <span class="scroll-hint"><span class="sh-dot"></span>Role para iniciar</span>
    </div>
    <div class="hero-area">
      <p class="h-eyebrow">20 desafios sonoros</p>
      <h1 class="h1">AtÃ© onde vai<br/><em>o seu fone?</em></h1>
      <p class="h-sub">Uma experiÃªncia imersiva projetada para levar cada frequÃªncia do seu headphone ao limite. Role a pÃ¡gina â€” cada tela Ã© um novo desafio.</p>
    </div>
    <div class="challenges-area" id="chips"></div>
  </div>
</section>

<!-- â•â•â• PLAYLIST PAGE â•â•â• -->
<section id="playlist-page">
  <div class="pl-bg"></div>
  <div class="pl-inner">
    <p class="pl-eyebrow">Playlist completa</p>
    <h2 class="pl-title">A trilha<br/><em>do teste</em></h2>
    <p class="pl-desc">20 faixas escolhidas para desafiar cada frequÃªncia do seu headphone. Salve no Spotify e faÃ§a o teste quando quiser.</p>
    <div class="pl-tracks-preview" id="plTrackList"></div>
    <div class="pl-btn-row">
      <a class="pl-open-btn" href="https://open.spotify.com/playlist/4N9QsntuVrFVrEl92QsjhK?si=6H9e25v2SriAtCZQiVH9ug" target="_blank" rel="noopener">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="#1DB954"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg>
        Abrir playlist no Spotify
      </a>
      <span class="pl-count">20 faixas Â· 5 nÃ­veis</span>
    </div>
  </div>
</section>

<!-- Track sections injetadas pelo JS -->
<div id="ts"></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const GC={'Metal Progressivo':'#e05c5c','Rock':'#e07a2f','Groove':'#d4c44a','Pop':'#5c9de0','Pop Alternative':'#a05ce0','R&B':'#e05c9d','Soul':'#e09a5c','Sertanejo':'#5ce07a','Pagode':'#5ccfe0','Rap Brasileiro':'#e0c45c','EletrÃ´nica':'#5c7ae0'};
const GG={'Metal Progressivo':'#7a1515','Rock':'#7a3a0a','Groove':'#6a600a','Pop':'#0a3a7a','Pop Alternative':'#3a0a7a','R&B':'#7a0a40','Soul':'#7a4a0a','Sertanejo':'#0a7a2f','Pagode':'#0a5a7a','Rap Brasileiro':'#7a5a0a','EletrÃ´nica':'#0a1a7a'};
const LE=['','ğŸŸ¢','ğŸŸ¡','ğŸŸ ','ğŸ”´','ğŸ’€'];
const LL=['','Aquecimento','MÃ©dio','DifÃ­cil','AvanÃ§ado','Extremo'];

const T=[
  {lv:1,ch:"EquilÃ­brio tonal geral",d:'Ã‰ o teste de equilÃ­brio tonal. Nada deve se sobressair; o baixo, a guitarra rÃ­tmica e a voz precisam coexistir em harmonia.',g:"Groove",s:"Get Lucky",a:"Daft Punk ft. Pharrell",sid:"69kOkLUCkxIZYexIgSG8rq",yt:"5NV6Rdv1h3Q"},
  {lv:1,ch:"Brilho de sintetizadores",d:'Testa o brilho dos sintetizadores. Se o fone tiver agudos pobres, essa mÃºsica perderÃ¡ a energia "oitentista".',g:"Pop",s:"Blinding Lights",a:"The Weeknd",sid:"0VjIjW4GlUZAMYd2vXMi3b",yt:"4NRXx6U8ABQ"},
  {lv:1,ch:"ExtensÃ£o de agudos limpos",d:"Testa a extensÃ£o de agudos. A percussÃ£o metÃ¡lica e os gritos do MJ devem ser brilhantes, mas nunca estridentes.",g:"Groove",s:"Don't Stop 'Til You Get Enough",a:"Michael Jackson",sid:"5ChkMS8OtdzJeqyybCc9R5",yt:"yURRmWtbTbo"},
  {lv:2,ch:"SeparaÃ§Ã£o vocal e instrumental",d:"Testa a separaÃ§Ã£o de instrumentos. A linha de baixo e a voz grave da Miley devem ser percebidas como camadas totalmente distintas.",g:"Pop",s:"Flowers",a:"Miley Cyrus",sid:"0yLdNVWF3Srea0uzk55zFn",yt:"G7KNmW9a75Y"},
  {lv:2,ch:"Corpo de mÃ©dios-graves",d:'Testa o corpo dos mÃ©dios-graves. A voz barÃ­tona deve soar profunda e rica, sem parecer "anasalada" ou magra.',g:"Soul",s:"No Love Dying",a:"Gregory Porter",sid:"2g9JIMhVlHpbHPdnGbfOkY",yt:"yv2TKBMqnpg"},
  {lv:2,ch:"Palco sonoro e dinÃ¢mica orquestral",d:"Desafia o palco sonoro. VocÃª deve sentir o crescimento da orquestra e a posiÃ§Ã£o da voz no centro.",g:"Soul",s:"Feeling Good",a:"Nina Simone",sid:"4mMbgHuoHEleRi4vFj0RgK",yt:"oHs0f0GFbDg"},
  {lv:2,ch:"Controle de sibilÃ¢ncia",d:'Foco em agudos e sibilÃ¢ncia. A voz da Hayley Williams testa se o fone machuca o ouvido com sons de "S" e "T".',g:"Rock",s:"Misery Business",a:"Paramore",sid:"0ByMNEPAPpOR5H69DVrTNy",yt:"aCyGvGEtOwc"},
  {lv:3,ch:"AmbiÃªncia e sub-grave aveludado",d:"Testa a ambiÃªncia e sub-graves. O grave deve preencher o fone de forma aveludada sem abafar a voz doce da cantora.",g:"R&B",s:"telepatÃ­a",a:"Kali Uchis",sid:"6Fht4kI3PtAAPEFsGiSQSf",yt:"UPDPXKsGKio"},
  {lv:3,ch:"Naturalidade e palco ao vivo",d:"Testa a naturalidade vocal em ambientes abertos. O bumbo da bateria sertaneja testa se o grave invade a frequÃªncia das vozes.",g:"Sertanejo",s:"ArranhÃ£o",a:"Lauana Prado",sid:"3FQNkc3mPPCqTFUCDhULUQ",yt:"hb5MW5qB9DM"},
  {lv:3,ch:"Detalhamento e estalo percussivo",d:"Testa o detalhamento de percussÃ£o. O estalo do pandeiro e do cavaco deve ser nÃ­tido e rÃ¡pido.",g:"Pagode",s:"PÃ© Na Areia",a:"Grupo Menos Ã‰ Mais",sid:"0Qhqz8MJc4IpjJJnTGjEPM",yt:"EWqnQBVFJaA"},
  {lv:3,ch:"SeparaÃ§Ã£o rÃ­tmica complexa",d:"Serve para analisar a separaÃ§Ã£o de muitos elementos rÃ­tmicos simultÃ¢neos em uma gravaÃ§Ã£o ao vivo.",g:"Pagode",s:"Sinal Vital",a:"Grupo RevelaÃ§Ã£o",sid:"1qDrGZsQmMGcJJMvnOGIas",yt:"zVuNkScqc-A"},
  {lv:4,ch:"DefiniÃ§Ã£o em alta densidade",d:"Testa a clareza em alta densidade. O ataque rÃ¡pido da bateria e as guitarras punk testam se o fone mantÃ©m a definiÃ§Ã£o sob pressÃ£o.",g:"Rock",s:"Basket Case",a:"Green Day",sid:"7EjyzZcaLBFFNYfZFfjMk4",yt:"NUTGr5t3MoY"},
  {lv:4,ch:"Controle de graves massivos",d:'Testa o controle de driver. O grave Ã© massivo, mas a voz Ã© um sussurro. O fone nÃ£o pode deixar o grave "atropelar" a delicadeza da voz.',g:"Pop Alternative",s:"bad guy",a:"Billie Eilish",sid:"2Fxmhks0bxGSBdJ92vM42m",yt:"DyDfgMOUjCI"},
  {lv:4,ch:"Impacto seco (punch) do driver",d:'Testa o impacto (punch). O bumbo (808) precisa ser forte e seco; se o fone for ruim, o grave soarÃ¡ "frouxo" ou distorcido.',g:"R&B",s:"MONACO",a:"Bad Bunny",sid:"4Ft8GHFvj8qlHE0Mry1Xhq",yt:"7VCPewIHPRk"},
  {lv:4,ch:"ResistÃªncia Ã  distorÃ§Ã£o dinÃ¢mica",d:"Desafia a capacidade dinÃ¢mica. O fone deve aguentar a potÃªncia vocal da Simone sem distorcer no refrÃ£o.",g:"Sertanejo",s:"Erro Gostoso",a:"Simone Mendes",sid:"3dJZR8vg6rj4lkANIfazpz",yt:"Z3r1T0kzMdE"},
  {lv:4,ch:"Contraste e dinÃ¢mica extrema",d:'Testa o contraste de frequÃªncias. A transiÃ§Ã£o entre a voz limpa e o "drop" pesado Ã© o cheque-mate para qualquer fone comum.',g:"Pop Alternative",s:"Hi-Lo (Hollow)",a:"Vance Joy",sid:"2x5MXKQZ6HHSA2cMCgPWTx",yt:"BI30T22RRBk"},
  {lv:5,ch:"Velocidade de resposta (transientes)",d:'Testa a velocidade de resposta. O fone precisa alternar entre violÃ£o limpo e distorÃ§Ã£o pesada sem deixar o som "atropelado".',g:"Metal Progressivo",s:"Ghost of Perdition",a:"Opeth",sid:"3O9NfKF9byHvKVSHXqjqiI",yt:"mq_HFbZrXzI"},
  {lv:5,ch:"SeparaÃ§Ã£o de camadas densas",d:"Desafia a separaÃ§Ã£o de camadas. As guitarras densas nÃ£o podem esconder os detalhes da bateria e do vocal.",g:"Metal Progressivo",s:"Blackest Eyes",a:"Porcupine Tree",sid:"0bsn6EsAuQ7n7OTorWZ0nb",yt:"gAkop7sRHQA"},
  {lv:5,ch:"Inteligibilidade de mÃ©dios com peso",d:"Testa a inteligibilidade. No meio de um bumbo pesado (boom-bap), a dicÃ§Ã£o e o peso da voz do Mano Brown devem ser perfeitamente claros.",g:"Rap Brasileiro",s:"A Vida Ã‰ Desafio",a:"Racionais MC's",sid:"5Ww4TFkv3BkHEDrFmvIf0c",yt:"1-E9tU6sMW4"},
  {lv:5,ch:"ExtensÃ£o mÃ¡xima de sub-bass",d:"Ã‰ o teste supremo de sub-bass. Se o seu fone nÃ£o tiver boa extensÃ£o de grave, vocÃª perderÃ¡ a nota mais profunda dessa mÃºsica.",g:"Rap Brasileiro",s:"777-666",a:"Veigh",sid:"6T88OcMHvRgIFObNHkwT0R",yt:"5-L2UbH9pJ8"},
];

/* â”€â”€ Detecta touch para desativar hover effects â”€â”€ */
const isTouch=('ontouchstart' in window)||navigator.maxTouchPoints>0;

/* â”€â”€ Custom cursor (sÃ³ desktop) â”€â”€ */
const cur=document.getElementById('cur'),curR=document.getElementById('curR');
let cx=0,cy=0,rx=0,ry=0;
if(!isTouch){
  document.addEventListener('mousemove',e=>{cx=e.clientX;cy=e.clientY;cur.style.left=cx+'px';cur.style.top=cy+'px'});
  (function aR(){rx+=(cx-rx)*.1;ry+=(cy-ry)*.1;curR.style.left=rx+'px';curR.style.top=ry+'px';requestAnimationFrame(aR)})();
}
function hov(on){if(!isTouch){cur.classList.toggle('h',on);curR.classList.toggle('h',on)}}

/* â”€â”€ Toast â”€â”€ */
let toastTimer;
function showToast(msg,dur=3000){
  const t=document.getElementById('toast');
  document.getElementById('toast-msg').textContent=msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>t.classList.remove('show'),dur);
}

/* â”€â”€ Build playlist track preview list â”€â”€ */
const plList=document.getElementById('plTrackList');
T.slice(0,8).forEach((t,i)=>{
  const c=GC[t.g]||'#1DB954';
  const pill=document.createElement('div');
  pill.className='pl-track-pill';
  pill.style.borderColor=i===0?c+'30':'rgba(255,255,255,.06)';
  pill.innerHTML=`<span class="pl-track-num">${String(i+1).padStart(2,'0')}</span><span class="pl-track-name" style="color:${i<3?'rgba(255,255,255,.8)':'rgba(255,255,255,.55)'}">${t.s}</span><span class="pl-track-artist">${t.a}</span>`;
  plList.appendChild(pill);
});
const more=document.createElement('div');
more.className='pl-track-pill';
more.style.justifyContent='center';
more.innerHTML=`<span style="font-size:.7rem;color:rgba(255,255,255,.2);letter-spacing:1px">+ 12 mais faixas no Spotify</span>`;
plList.appendChild(more);

/* â”€â”€ Build chips on landing â”€â”€ */
const chipsEl=document.getElementById('chips');
const byLevel={};
T.forEach((t,i)=>{(byLevel[t.lv]||(byLevel[t.lv]=[])).push({...t,idx:i})});
[1,2,3,4,5].forEach(lv=>{
  const group=byLevel[lv]||[];if(!group.length)return;
  const color=GC[group[0].g]||'#1DB954';
  const row=document.createElement('div');row.className='lvl-row';
  const pips=Array.from({length:5},(_,i)=>`<div class="lvl-pip" style="${i<lv?'background:'+color+'70':''}"></div>`).join('');
  row.innerHTML=`<div class="lvl-tag"><div class="lvl-name">${LE[lv]} NÃ­vel ${lv}</div><div class="lvl-pips">${pips}</div></div><div class="chips" id="c${lv}"></div>`;
  chipsEl.appendChild(row);
  const cr=row.querySelector(`#c${lv}`);
  group.forEach(t=>{
    const c=GC[t.g]||'#1DB954';
    const el=document.createElement('div');el.className='chip';el.style.setProperty('--c',c);
    el.innerHTML=`<span>${t.ch}</span>`;
    el.addEventListener('click',()=>goToTrack(t.idx));
    el.addEventListener('mouseenter',()=>hov(true));
    el.addEventListener('mouseleave',()=>hov(false));
    cr.appendChild(el);
  });
});

/* â”€â”€ Build track sections â”€â”€ */
const tsEl=document.getElementById('ts');
T.forEach((t,i)=>{
  const c=GC[t.g]||'#1DB954';
  const g2=GG[t.g]||'#0a3a0a';
  const isLast=i===T.length-1;
  const wBars=Array.from({length:20},(_,wi)=>`<div class="wb" style="height:${8+Math.random()*28}px;animation-delay:${wi*.055}s"></div>`).join('');
  const dPips=Array.from({length:5},(_,pi)=>`<div class="d-pip${pi<t.lv?' on':''}"></div>`).join('');
  const sec=document.createElement('section');
  sec.className='ts';sec.id=`t${i}`;sec.dataset.i=i;sec.style.setProperty('--tc',c);
  sec.innerHTML=`
    <div class="t-bg" id="bg${i}" style="background:radial-gradient(ellipse 55% 55% at 30% 55%,${c}35,transparent 55%),radial-gradient(ellipse 45% 45% at 70% 45%,${g2}28,transparent 55%),#07070f"></div>
    <div class="t-ov"></div>
    <div class="t-prog" id="p${i}"></div>
    <div class="t-nav">
      <span class="t-ctr">${String(i+1).padStart(2,'0')} / ${String(T.length).padStart(2,'0')}</span>
      <span class="t-genre" style="--tc:${c}">${t.g}</span>
    </div>
    <div class="t-content">
      <div>
        <p class="challenge-label" style="color:${c};--tc:${c}">${LE[t.lv]} ${LL[t.lv]} Â· NÃ­vel ${t.lv}</p>
        <h2 class="t-title">${t.s}</h2>
        <p class="t-artist">${t.a}</p>
        <p class="t-desc">${t.d}</p>
      </div>
      <div class="t-player">
        <div class="vinyl" id="v${i}" style="--tc:${c}"></div>
        <div class="waveform" id="w${i}" style="--tc:${c}">${wBars}</div>
        <div class="controls-row">
          <button class="play-btn" id="pb${i}" data-i="${i}" style="--tc:${c}">â–¶</button>
        </div>
        <div class="a-prog">
          <div class="a-track" id="at${i}"><div class="a-fill" id="af${i}"></div></div>
          <div class="a-times"><span id="atm${i}">0:00</span><span id="adu${i}">â€”</span></div>
        </div>
      </div>
    </div>
    <div class="t-footer">
      <div class="diff"><span>Dificuldade</span><div class="d-pips">${dPips}</div></div>
      ${!isLast?`<div class="next-cue">PrÃ³xima <div class="nc-arrow"></div></div>`:`<div style="font-size:.6rem;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,.15)">Fim âœ“</div>`}
    </div>`;
  tsEl.appendChild(sec);

  sec.querySelector(`#pb${i}`).addEventListener('click',()=>handlePlayClick(i));
  if(!isTouch){
    sec.querySelector(`#pb${i}`).addEventListener('mouseenter',()=>hov(true));
    sec.querySelector(`#pb${i}`).addEventListener('mouseleave',()=>hov(false));
  }
  sec.querySelector(`#at${i}`).addEventListener('click',e=>{
    if(ytPlayer&&currentTrackIdx===i&&ytPlayer.getDuration){
      const r=e.currentTarget.getBoundingClientRect();
      const pct=(e.clientX-r.left)/r.width;
      ytPlayer.seekTo(pct*ytPlayer.getDuration(),true);
    }
  });
});

/* â”€â”€ Side dots â”€â”€ */
const sdots=document.getElementById('sdots');
const allSecs=[
  document.getElementById('landing'),
  document.getElementById('playlist-page'),
  ...T.map((_,i)=>document.getElementById(`t${i}`))
];
allSecs.forEach((sec,i)=>{
  const d=document.createElement('div');d.className='sdot'+(i===0?' active':'');
  d.addEventListener('click',()=>sec.scrollIntoView({behavior:'smooth'}));
  if(!isTouch){d.addEventListener('mouseenter',()=>hov(true));d.addEventListener('mouseleave',()=>hov(false));}
  sdots.appendChild(d);
});
function updateDots(i){document.querySelectorAll('.sdot').forEach((d,j)=>d.classList.toggle('active',j===i))}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   YouTube IFrame API
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let ytPlayer=null,ytReady=false,currentTrackIdx=-1,pendingPlay=-1,progressTimer=null,autoPlayEnabled=false;

window.onYouTubeIframeAPIReady=function(){
  ytPlayer=new YT.Player('yt-player',{
    height:'1',width:'1',videoId:'',
    playerVars:{autoplay:0,controls:0,disablekb:1,fs:0,iv_load_policy:3,modestbranding:1,rel:0,showinfo:0,playsinline:1,origin:window.location.origin||'https://localhost'},
    events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange,onError:onPlayerError}
  });
};

function onPlayerReady(){ytReady=true;if(pendingPlay>=0){const idx=pendingPlay;pendingPlay=-1;loadAndPlay(idx);}}

// DetecÃ§Ã£o e skip automÃ¡tico de anÃºncios do YouTube
let adCheckTimer=null;
function startAdCheck(){
  stopAdCheck();
  adCheckTimer=setInterval(()=>{
    if(!ytPlayer||!ytReady||currentTrackIdx<0)return;
    try{
      const vd=ytPlayer.getVideoData&&ytPlayer.getVideoData();
      if(vd&&vd.video_id&&vd.video_id!==T[currentTrackIdx].yt){
        // ID diferente do esperado = anÃºncio em reproduÃ§Ã£o, pula para o fim
        ytPlayer.seekTo(ytPlayer.getDuration(),true);
      }
    }catch(e){}
  },400);
}
function stopAdCheck(){if(adCheckTimer){clearInterval(adCheckTimer);adCheckTimer=null;}}

function onPlayerStateChange(e){
  const s=YT.PlayerState;
  if(e.data===s.PLAYING){
    startAdCheck();
    // SÃ³ atualiza UI se for o vÃ­deo certo, nÃ£o um anÃºncio
    try{
      const vd=ytPlayer.getVideoData&&ytPlayer.getVideoData();
      if(vd&&vd.video_id===T[currentTrackIdx].yt){
        setPlayingUI(currentTrackIdx,true);
        startProgressTimer();
        showToast(`â–¶ ${T[currentTrackIdx].s} â€” ${T[currentTrackIdx].a}`,4000);
      }
    }catch(err){
      setPlayingUI(currentTrackIdx,true);startProgressTimer();
    }
  }
  else if(e.data===s.PAUSED){setPlayingUI(currentTrackIdx,false);stopProgressTimer();stopAdCheck();}
  else if(e.data===s.ENDED){
    stopAdCheck();
    // Se terminou mas era anÃºncio, retoca a mÃºsica real
    try{
      const vd=ytPlayer.getVideoData&&ytPlayer.getVideoData();
      if(vd&&vd.video_id!==T[currentTrackIdx].yt){
        ytPlayer.loadVideoById({videoId:T[currentTrackIdx].yt,startSeconds:0});
        return;
      }
    }catch(e){}
    setPlayingUI(currentTrackIdx,false);stopProgressTimer();resetProgress(currentTrackIdx);
  }
  else if(e.data===s.BUFFERING){const btn=document.getElementById(`pb${currentTrackIdx}`);if(btn){btn.classList.add('loading');btn.innerHTML='â—‹';}}
}

function onPlayerError(){showToast('âš  VÃ­deo indisponÃ­vel â€” tente o Spotify â†—',4000);setPlayingUI(currentTrackIdx,false);stopProgressTimer();stopAdCheck();}

function loadAndPlay(idx){
  if(!ytReady){pendingPlay=idx;return;}
  stopAdCheck();
  currentTrackIdx=idx;
  setPlayingUI(idx,false);
  const btn=document.getElementById(`pb${idx}`);
  if(btn){btn.classList.add('loading');btn.innerHTML='â—‹';}
  ytPlayer.loadVideoById({videoId:T[idx].yt,startSeconds:0});
  ytPlayer.setVolume(100);
  setTimeout(()=>{if(ytPlayer.getDuration){const d=ytPlayer.getDuration();if(d>0){const m=Math.floor(d/60),s=Math.floor(d%60).toString().padStart(2,'0');const el=document.getElementById(`adu${idx}`);if(el)el.textContent=`${m}:${s}`;}}},1500);
}

function stopAll(){
  if(ytPlayer&&ytReady&&typeof ytPlayer.pauseVideo==='function')ytPlayer.pauseVideo();
  if(currentTrackIdx>=0){setPlayingUI(currentTrackIdx,false);stopProgressTimer();}
}

function startProgressTimer(){
  stopProgressTimer();
  progressTimer=setInterval(()=>{
    if(!ytPlayer||!ytReady)return;
    try{
      const c=ytPlayer.getCurrentTime(),d=ytPlayer.getDuration();
      if(!d)return;
      const pct=(c/d)*100;
      const f=document.getElementById(`af${currentTrackIdx}`);
      const p=document.getElementById(`p${currentTrackIdx}`);
      const tm=document.getElementById(`atm${currentTrackIdx}`);
      const du=document.getElementById(`adu${currentTrackIdx}`);
      if(f)f.style.width=pct+'%';
      if(p)p.style.width=pct+'%';
      if(tm){const m=Math.floor(c/60),s=Math.floor(c%60).toString().padStart(2,'0');tm.textContent=`${m}:${s}`;}
      if(du&&du.textContent==='â€”'){const m=Math.floor(d/60),s=Math.floor(d%60).toString().padStart(2,'0');du.textContent=`${m}:${s}`;}
    }catch(e){}
  },500);
}

function stopProgressTimer(){if(progressTimer){clearInterval(progressTimer);progressTimer=null;}}

function resetProgress(idx){
  const f=document.getElementById(`af${idx}`),p=document.getElementById(`p${idx}`),t=document.getElementById(`atm${idx}`);
  if(f)f.style.width='0%';if(p)p.style.width='0%';if(t)t.textContent='0:00';
}

function setPlayingUI(idx,on){
  if(idx<0)return;
  const btn=document.getElementById(`pb${idx}`),v=document.getElementById(`v${idx}`),w=document.getElementById(`w${idx}`);
  if(btn){btn.innerHTML=on?'â¸':'â–¶';btn.classList.toggle('playing',on);btn.classList.remove('loading');}
  if(v)v.classList.toggle('playing',on);
  if(w)w.classList.toggle('playing',on);
}

function handlePlayClick(idx){
  autoPlayEnabled=true;
  if(currentTrackIdx===idx){
    if(ytPlayer&&ytReady){const state=ytPlayer.getPlayerState();if(state===YT.PlayerState.PLAYING)ytPlayer.pauseVideo();else ytPlayer.playVideo();}
  } else {loadAndPlay(idx);}
}

function goToTrack(idx){
  const sec=document.getElementById(`t${idx}`);
  if(sec){autoPlayEnabled=true;sec.scrollIntoView({behavior:'smooth'});setTimeout(()=>loadAndPlay(idx),700);}
}

/* â”€â”€ IntersectionObserver â”€â”€ */
const obs=new IntersectionObserver(entries=>{
  entries.forEach(entry=>{
    if(!entry.isIntersecting||entry.intersectionRatio<.6)return;
    const sec=entry.target;
    const dotIdx=allSecs.indexOf(sec);
    if(dotIdx>=0)updateDots(dotIdx);
    if(sec.id==='landing'||sec.id==='playlist-page'){stopAll();return;}
    const i=parseInt(sec.dataset.i);if(isNaN(i))return;
    if(autoPlayEnabled&&i!==currentTrackIdx)loadAndPlay(i);
  });
},{threshold:.6});
allSecs.forEach(s=>obs.observe(s));

/* â”€â”€ Unlock autoplay on first gesture â”€â”€ */
['scroll','click','touchstart','keydown','mousedown'].forEach(ev=>{
  document.addEventListener(ev,()=>{autoPlayEnabled=true;},{once:true,passive:true});
});
</script>
</body>
</html>
